/*!
 * nodetpl v3.3.2
 * Best javascript template engine
 * https://www.nodetpl.com
 *
 * Copyright 2012-2015 pillys@163.com
 * Released under the MIT license
 */
(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(factory)}else if(typeof define==="function"&&define.cmd){define(factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.nodetpl=factory()}})(this,function(require,exports,module){var nodetpl;if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};function NodeTpl(){this.version="3.3.2";this.ie6=window.VBArray&&!window.XMLHttpRequest;this.guid=function(){return"NTGUID__"+(this.guid._counter++).toString(36)};this.duid=function(){return"NTDUID__"+(this.duid._counter++).toString(36)};this.guid._counter=1;this.duid._counter=1;this._data={};this._tpls={};this._cache={};this._docid="_tpl_";this.options={base:"",openTag:"<?",closeTag:"?>"};return this}NodeTpl.prototype.config=function(options){if(options){this._extend(this.options,options);return this}else{return this.options}};NodeTpl.prototype._extend=function(obj,options){var hasOwnProperty=Object.prototype.hasOwnProperty;options=options||{};for(var i in options){if(!hasOwnProperty.call(options,i))continue;obj[i]=options[i]}return obj};NodeTpl.prototype._split=function(str,separator,limit){if(Object.prototype.toString.call(separator)!=="[object RegExp]"){return str.split(separator,limit)}var output=[],lastLastIndex=0,flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.sticky?"y":""),separator=RegExp(separator.source,flags+"g"),_compliantExecNpcg=/()??/.exec("")[1]===undefined,separator2,match,lastIndex,lastLength;str=str+"";if(!_compliantExecNpcg)separator2=RegExp("^"+separator.source+"$(?!\\s)",flags);if(limit===undefined||+limit<0){limit=Infinity}else{limit=Math.floor(+limit);if(!limit)return[]}while(match=separator.exec(str)){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(!_compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undefined)match[i]=undefined}})}if(match.length>1&&match.index<str.length)Array.prototype.push.apply(output,match.slice(1));lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit)break}if(separator.lastIndex===match.index)separator.lastIndex++}if(lastLastIndex===str.length){if(lastLength||!separator.test(""))output.push("")}else{output.push(str.slice(lastLastIndex))}return output.length>limit?output.slice(0,limit):output};NodeTpl.prototype._getCurrentScript=function(){var doc=document,head,nodes;if(doc.currentScript){return doc.currentScript.src}var stack;try{a.b.c()}catch(e){stack=e.stack;if(!stack&&window.opera){stack=(String(e).match(/of linked script \S+/g)||[]).join(" ")}}if(stack){stack=stack.replace(/(at Global code \([^\)]+\))[\s\S]*/i,"$1");stack=stack.split(/[@ ]/g).pop();stack=stack[0]=="("?stack.slice(1,-1):stack;return stack.replace(/(:\d+)?:\d+$/i,"")}head=doc.head||doc.getElementsByTagName("head")[0];nodes=head.getElementsByTagName("script");for(var i=0,node;node=nodes[i++];){if(node.readyState==="interactive"){return node.className=node.src}}};NodeTpl.prototype._fixcss=function(css){var style=document.getElementById("nodetpl_css");if(!style){style=document.createElement("style");style.setAttribute("type","text/css");style.setAttribute("id","nodetpl_css");document.getElementsByTagName("head")[0].appendChild(style)}if(style.styleSheet){style.styleSheet.cssText+=css}else{style.appendChild(document.createTextNode(css))}};NodeTpl.prototype.css=function(css){if(!css){return""}if(this.ie6){var style=document.getElementById("nodetpl_css");if(!style){style=document.createElement("style");style.setAttribute("type","text/css");style.setAttribute("id","nodetpl_css");document.getElementsByTagName("head")[0].appendChild(style)}if(style.styleSheet){style.styleSheet.cssText+=css}else{style.appendChild(document.createTextNode(css))}return""}else{return"<style>"+css+"</style>\n"}};NodeTpl.prototype._template=function(html){var temp,list={},regExp=/<template(.*name=['"]([^'"]+)*)?\b[^>]*>([^<]*(?:(?!<\/template>)<[^<]*)*)<\/template>/gim;while(temp=regExp.exec(html)){if(temp[2]){list[temp[2]]=temp[3]}}list["main"]=list["main"]||html;return list};NodeTpl.prototype.render=function(html,data,callback){var path,result;if(typeof html!=="string"){throw new TypeError}path=this._docid+Math.random().toString();if(typeof window!=="undefined"){new Function(this.compile(path,html))()}else{var context=new vm.createContext({console:console,require:require,exports:{},module:{uri:path}});new vm.Script(that.compile(filepath,content)).runInContext(context)}return this._getJs(path,data,callback)};NodeTpl.prototype.exec=function(content){var code,jsExp=/<script\b[^>]*>([^<]*(?:(?!<\/script>)<[^<]*)*)<\/script>/gim;while(code=jsExp.exec(content)){new Function(code[1])()}return this};NodeTpl.prototype._load=function(url,callback){var that=this,d=document.createElement("script");d.type="text/javascript";if(d.readyState){d.onreadystatechange=function(){if(that.ie6&&!this.getAttribute("initialized")){document.getElementsByTagName("head")[0].appendChild(d);this.setAttribute("initialized",true)}if(this.readyState=="loaded"||this.readyState=="complete"){this.onreadystatechange=null;callback&&callback.call(that)}};d.src=url;!this.ie6&&document.getElementsByTagName("head")[0].appendChild(d)}else{d.src=url;d.onload=function(){callback&&callback.call(that)};document.getElementsByTagName("head")[0].appendChild(d)}return this};NodeTpl.prototype._ajax=function(options){var xmlHttp;options=this._extend({type:"get",async:true,data:"",success:function(data){}},options);try{xmlHttp=new XMLHttpRequest}catch(e){try{xmlHttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xmlHttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return false}}}xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){options.success.call(xmlHttp,xmlHttp.responseText)}};xmlHttp.open(options.type,options.url,options.async);xmlHttp.send(options.data);return this};NodeTpl.prototype.get=function(url,data,callback){var that=this;if(/\/[^\/\.]+$|\.js$/.test(url.replace(/(\?#).*$/,""))){that._getJs(url,data,callback)}else{if(typeof data==="function"){callback=data;data=null}that._ajax({url:url,type:"get",success:function(content){that.render(content,data,callback)}})}};NodeTpl.prototype._getUrl=function(url){url=url.trim();if(url.indexOf(this._docid)!==0){if(typeof location!=="undefined"){if(!/^(https?:|\/{2})/.test(url)){url=this.options.base+url}if(/^\/[^\/]/.test(url)){url="//"+location.host+url}if(/^\/{2}/.test(url)){url=location.protocol+url}if(!/\.js$/.test(url)){url=url+".js"}}}return url};NodeTpl.prototype._getJs=function(url,data,callback){var that=this,delayData,normalCallback,moduleCallback,_cache=that._cache,_tpls=that._tpls,_data=that._data;url=that._getUrl(url);if(data===false){delayData={render:function(_data){return _tpls[url].main(_data||{})},toString:function(){return _cache[url]?_cache[url].html:this}}}if(typeof data==="function"){callback=data;data={}}moduleCallback=function(template){if(typeof callback!=="function")return false;if(data===false){callback.call(that,delayData)}else{callback(template.main(data))}};normalCallback=function(){if(typeof callback!=="function")return false;if(data===false){callback.call(that,delayData)}else{callback.call(that,_tpls[url].main(data))}};if(typeof define==="function"){if(define.amd&&typeof require==="function"){require([url],moduleCallback)}else if(define.cmd&&typeof seajs==="object"){seajs.use([url],moduleCallback)}}else{if(url.indexOf(that._docid)===0||typeof _tpls[url]==="object"&&typeof _tpls[url].main==="function"){normalCallback()}else{that._load(url,function(){if(typeof _tpls[url]==="object"&&typeof _tpls[url].main==="function"){normalCallback()}})}}};NodeTpl.prototype._fetch=function(html){var that=this,list,htmlCode="",jsCode="",cssCode="",cache={};var hasOwnProperty=Object.prototype.hasOwnProperty,jsExp=/<script\b[^>]*>([^<]*(?:(?!<\/script>)<[^<]*)*)<\/script>/gim,cssExp=/<style\b[^>]*>([^<]*(?:(?!<\/style>)<[^<]*)*)<\/style>/gim;list=this._template(html);for(var tplname in list){if(!hasOwnProperty.call(list,tplname)){continue}cssCode="";jsCode="";htmlCode=list[tplname];if(!htmlCode){continue}htmlCode=htmlCode.replace(cssExp,function($,$1){return cssCode+="\n"+$1,""}).replace(jsExp,function($,$1){return jsCode+="\n"+$1,""});cache[tplname]={css:that._css(cssCode.trim(),tplname),html:that._html(htmlCode.trim(),tplname),js:that._js(jsCode.trim(),tplname)}}return cache};NodeTpl.prototype._css=function(content,tplname){if(content){content=content.replace(/'/g,"\\'").replace(/\/\*(.|\n)*?\*\/|\r?\n/gi,"").replace(/([a-zA-Z0-9_\-#*\.:\s,\(\)'"<>=]*)(\{)/gi,function(a,b,c){var sguid;if(tplname==="main"){sguid="guid"}else{sguid="guid + duid"}b=b.trim();if(b===""){return"#' + "+sguid+" + '"+c}else{var _b=b.split(",");for(var i=0;i<_b.length;i++){_b[i]=_b[i].trim();_b[i]="\\n#' + "+sguid+" + '"+(_b[i].indexOf(":")===0?"":" ")+_b[i]}return _b.join(",")+c}});if(content!==""){content="    css += '"+content+"';"}}return content};NodeTpl.prototype._js=function(content,tplname){var jsarr;if(content){jsarr=this._split(content,/\r?\n/g);for(var i=0;i<jsarr.length;i++){if(!jsarr[i])continue;jsarr[i]="    _ += '"+jsarr[i].replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\r\n/g,"\n").replace(/\n/g,"\\n").replace(/(^|[^\.])include\(([^\)]*)\)/gi,function(a,b,c){var _c=(c||"").split(",");_c.map(function(value,index){_c[index]=_c[index].trim()});return b+"$TPLS["+_c[0]+"]("+(_c.length>1?_c[1]:"$DATA")+", guid)"})+"\\n';\n"}content=jsarr.join("")}return content};NodeTpl.prototype._html=function(content,tplname){var that=this,html,vars,tagExp,openTag,closeTag,getTag;if(content){getTag=function(tag){return tag.replace(/([\$\(\)\*\+\.\[\]\?\\\^\{\}\|])/g,"\\$1")};openTag=getTag(that.options.openTag);closeTag=getTag(that.options.closeTag);html=this._split(content,new RegExp("("+openTag+"[\\s\\S]*?"+closeTag+")"));for(var i=0;i<html.length;i++){if(!html[i])continue;tagExp=new RegExp(openTag+"([\\s\\S]*?)"+closeTag,"igm");if(tagExp.test(html[i])){html[i]=html[i].replace(tagExp,"$1");html[i]=html[i].replace(/@([a-zA-Z\$_]+)/gim,"$DATA.$1");html[i]=html[i].replace(/print\((.*?)\);/gim,"    template.push(($1) || '');\n");if(html[i].indexOf("=")===0){html[i]=html[i].substring(1).trim();if(!/^\d/.test(html[i])){vars=(/^(\(*)([a-zA-Z\d_\$\s\.]+)/.exec(html[i])||[0,0,""])[2];if(vars!==""){html[i]="    if (typeof "+vars+' !== "undefined") {\n'+"      _ += ("+html[i]+");\n"+"    }\n"}else{html[i]="    _ += ("+html[i]+");\n"}}else{html[i]="    _ += ("+html[i]+");\n"}}}else{html[i]="\n    _ += '"+html[i].replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\r\n/g,"\n").replace(/\n/g,"\\n")+"';\n"}}content=html.join("");content=content.replace(/\$ROOT/gim,"'+ guid +'");content=content.replace(/\$SUBROOT/gim,"'+ guid + duid +'")}content="try{\n"+"with($DATA || {}){\n"+content+"\n}"+"} catch(e){ console.log(e.stack); }\n";return content};NodeTpl.prototype.compile=function(path,html){if(typeof path!=="string"||typeof html!=="string"){throw new TypeError}return this._compile(path,this._fetch(html))};NodeTpl.prototype._compile=function(path,cache){var temp,html="",list=[],hasOwnProperty=Object.prototype.hasOwnProperty;for(var i in cache){if(!hasOwnProperty.call(cache,i)){continue}temp="";temp+='  "'+i+'": function($DATA, guid){\n';temp+="    var _ = '';\n";temp+="    var css = '';\n";temp+="    var duid = nodetpl.duid();\n";temp+="    guid = guid || nodetpl.guid();\n";if(cache[i].css){temp+=cache[i].css+"\n";temp+="    _ += nodetpl.css(css);"}if(cache[i].html){temp+=cache[i].html}if(cache[i].js){temp+="    _ += '\\n<script>\\n';\n";temp+="    _ += '(function(window, document, undefined){\\n';\n";temp+="    _ += '  var _module_id = Math.random().toString();\\n';\n";temp+="    _ += '  var _factory = function(require, exports, module){\\n';\n";temp+="    _ += '    var nodetpl = typeof require === \\'function\\' ? require(\\'nodetpl\\') : window.nodetpl;\\n';\n";temp+="    _ += '    var ROOT, $ROOT, SUBROOT, $SUBROOT, $TPLS, $DATA;\\n';\n";temp+="    _ += '    var guid = \\''+ guid + '\\', duid = \\''+ duid + '\\';\\n';\n";temp+="    _ += '    ROOT = document.getElementById(guid);\\n';\n";temp+="    _ += '    SUBROOT = document.getElementById(guid + duid);\\n';\n";temp+="    _ += '    $TPLS = nodetpl._tpls[\"'+ tpl_id +'\"];\\n';\n";temp+="    _ += '    $DATA = nodetpl._data[duid];\\n';\n";temp+=cache[i].js;temp+="    _ += '  }\\n';\n";temp+="    _ += '  if(typeof define === \\'function\\'){\\n';\n";temp+="    _ += '    define(_module_id, _factory);\\n';\n";temp+="    _ += '    if (define.amd && typeof require === \\'function\\') {\\n';\n";temp+="    _ += '      require([_module_id]);\\n';\n";temp+="    _ += '    } else if (define.cmd && typeof seajs === \\'object\\') {\\n';\n";temp+="    _ += '      seajs.use([_module_id]);\\n';\n";temp+="    _ += '    }\\n';\n";temp+="    _ += '  } else {\\n';\n";temp+="    _ += '    _factory();\\n';\n";temp+="    _ += '  }\\n';\n";temp+="    _ += '})(window, document);';\n";temp+="    _ += '</script>\\n';\n"}temp+="    $DATA && (nodetpl._data[duid] = $DATA);\n";temp+="    return _;\n";temp+="  }";list.push(temp)}html+="(function(root, factory) {\n";html+=" if (typeof define === 'function') {\n";if(path.indexOf(this._docid)===0){html+="   define('"+path+"', factory);\n"}else{html+="   define(factory);\n"}html+=" } else if (typeof require === 'function' && typeof exports === 'object') {\n";html+="   factory(require, exports, module);\n";html+=" } else {\n";html+="   factory();\n";html+=" }\n";html+="}(this, function(require, exports, module) {\n";html+="  var nodetpl = typeof require === 'function' ? require('nodetpl') : window.nodetpl;\n";if(path.indexOf(this._docid)===0){html+="  var tpl_id = '"+path+"';\n"}else{html+="  var tpl_id = module && module.uri ? module.uri : nodetpl._getCurrentScript();\n"}html+="  nodetpl._tpls[tpl_id] = {\n";html+=list.join(",\n");html+="\n};\n";html+="  return nodetpl._tpls[tpl_id];\n";html+="}));";return html};nodetpl=new NodeTpl;return nodetpl});